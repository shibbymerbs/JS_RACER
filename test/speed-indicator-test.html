<!DOCTYPE html>
<html>

<head>
    <title>Speed Indicator Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            display: flex;
            gap: 40px;
            margin-top: 20px;
        }

        .section {
            border: 1px solid #ccc;
            padding: 20px;
            border-radius: 5px;
            width: 300px;
        }

        h2 {
            margin-top: 0;
            color: #333;
        }

        button {
            padding: 8px 16px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Speed Indicator Test</h1>

    <div class="container">
        <div class="section">
            <h2>Game Elements</h2>
            <div id="gameCanvasContainer"
                style="position: relative; width: 400px; height: 300px; background: #f0f0f0; margin-bottom: 10px;">
                <!-- Game canvas would be here -->
            </div>

            <!-- Speed Boost Indicator (now repurposed as speed display) -->
            <div id="speedBoostIndicator"
                style="display: none; position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); background-color: rgba(0,0,0,0.7); color: white; padding: 8px 16px; border-radius: 20px; font-size: 14px; z-index: 100;">
                Speed: <span id="speedValue">50</span> km/hr
            </div>

            <!-- Cooldown Bar -->
            <div id="cooldownBar"
                style="display: none; position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); width: 200px; height: 10px; background-color: #333; border-radius: 5px;">
                <div id="cooldownFill" style="width: 0%; height: 100%; background-color: #ff6b6b; border-radius: 5px;">
                </div>
            </div>
        </div>

        <div class="section">
            <h2>Test Controls</h2>
            <button id="testNormalSpeed">Test Normal Speed (50 km/hr)</button><br>
            <button id="testBoostedSpeed">Test Boosted Speed (60-80 km/hr)</button><br>
            <button id="testCooldownSpeed">Test Cooldown Speed (50-55 km/hr)</button><br>
            <button id="testCooldownActive">Test Cooldown Active</button><br>
            <button id="resetAll">Reset All</button>

            <div style="margin-top: 20px;">
                <h3>Current State:</h3>
                <p>Speed Boost Active: <span id="boostStatus">false</span></p>
                <p>Cooldown Active: <span id="cooldownStatus">false</span></p>
                <p>Speed Multiplier: <span id="speedMultiplier">1.0</span></p>
            </div>
        </div>
    </div>

    <script>
        // Mock game state
        const gameState = {
            speedBoostActive: false,
            boostCooldownEndTime: 0,
            speedMultiplier: 1.0,
            player: {
                speedHistory: [],
                maxSpeedHistory: 20,
                getCurrentSpeed() {
                    const baseSpeed = 50;
                    if (this.game.speedBoostActive) {
                        return Math.min(80, baseSpeed + (this.game.speedMultiplier - 1) * 20);
                    } else if (Date.now() < this.game.boostCooldownEndTime && this.game.boostCooldownEndTime > 0) {
                        const cooldownProgress = 1 - Math.min(1, (this.game.boostCooldownEndTime - Date.now()) / 2000);
                        return baseSpeed * (0.9 + cooldownProgress * 0.1);
                    }
                    return baseSpeed;
                },
                updateSpeedHistory() {
                    const currentSpeed = this.getCurrentSpeed();
                    this.speedHistory.push(currentSpeed);
                    if (this.speedHistory.length > this.maxSpeedHistory) {
                        this.speedHistory.shift();
                    }
                },
                getAverageSpeed() {
                    if (this.speedHistory.length === 0) return 50;
                    const sum = this.speedHistory.reduce((acc, speed) => acc + speed, 0);
                    return Math.round(sum / this.speedHistory.length * 10) / 10;
                }
            }
        };

        // Set up references
        gameState.player.game = gameState;

        // DOM elements
        const speedBoostIndicator = document.getElementById('speedBoostIndicator');
        const cooldownBar = document.getElementById('cooldownBar');
        const cooldownFill = document.getElementById('cooldownFill');
        const speedValue = document.getElementById('speedValue');
        const boostStatus = document.getElementById('boostStatus');
        const cooldownStatus = document.getElementById('cooldownStatus');
        const speedMultiplier = document.getElementById('speedMultiplier');

        // Test buttons
        document.getElementById('testNormalSpeed').addEventListener('click', () => {
            gameState.speedBoostActive = false;
            gameState.boostCooldownEndTime = 0;
            gameState.speedMultiplier = 1.0;
            updateDisplay();
        });

        document.getElementById('testBoostedSpeed').addEventListener('click', () => {
            gameState.speedBoostActive = true;
            gameState.boostCooldownEndTime = Date.now() + 3000; // 3 seconds boost
            gameState.speedMultiplier = 1.5;
            updateDisplay();
        });

        document.getElementById('testCooldownSpeed').addEventListener('click', () => {
            gameState.speedBoostActive = false;
            gameState.boostCooldownEndTime = Date.now() + 3000; // 3 seconds cooldown
            gameState.speedMultiplier = 1.0;
            updateDisplay();
        });

        document.getElementById('testCooldownActive').addEventListener('click', () => {
            gameState.speedBoostActive = false;
            gameState.boostCooldownEndTime = Date.now() + 3000; // 3 seconds cooldown
            gameState.speedMultiplier = 1.0;
            updateDisplay();
        });

        document.getElementById('resetAll').addEventListener('click', () => {
            gameState.speedBoostActive = false;
            gameState.boostCooldownEndTime = 0;
            gameState.speedMultiplier = 1.0;
            gameState.player.speedHistory = [];
            updateDisplay();
        });

        function updateDisplay() {
            // Update player speed history
            gameState.player.updateSpeedHistory();

            // Show/hide and update speed indicator
            const averageSpeed = gameState.player.getAverageSpeed();
            speedValue.textContent = averageSpeed;
            speedBoostIndicator.style.display = 'block';

            // Update cooldown bar visibility and fill
            if (gameState.boostCooldownEndTime > Date.now()) {
                const remaining = gameState.boostCooldownEndTime - Date.now();
                const progress = Math.min(1, remaining / 3000);
                cooldownFill.style.width = `${progress * 100}%`;
                cooldownBar.style.display = 'block';
            } else {
                cooldownBar.style.display = 'none';
            }

            // Update status displays
            boostStatus.textContent = gameState.speedBoostActive;
            cooldownStatus.textContent = gameState.boostCooldownEndTime > Date.now();
            speedMultiplier.textContent = gameState.speedMultiplier.toFixed(1);
        }

        // Initial update
        updateDisplay();

        // Update every 100ms to simulate game loop
        setInterval(updateDisplay, 100);
    </script>
</body>

</html>